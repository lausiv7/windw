# 14-01. AI ëŒ€í™”ì‹ ì›¹ì‚¬ì´íŠ¸ ë¹Œë” ì„¤ê³„ ë° êµ¬í˜„ (Enhanced)

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” **14ë²ˆ ê¸°ë³¸ ë¬¸ì„œ**ë¥¼ ë°”íƒ•ìœ¼ë¡œ WindWalkerì˜ ê¸°ì¡´ MessageBridge ì•„í‚¤í…ì²˜ë¥¼ í™•ì¥í•˜ì—¬ **í…œí”Œë¦¿ ê¸°ë°˜ AI ëŒ€í™”ì‹ ì›¹ì‚¬ì´íŠ¸ ë¹Œë”**ë¥¼ í†µí•©í•˜ëŠ” ì„¤ê³„ ë° êµ¬í˜„ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤. **07ë²ˆ ë¬¸ì„œ êµ¬ì¡°**ë¥¼ ë”°ë¼ ì„¤ê³„ì™€ êµ¬í˜„ ì½”ë“œë¥¼ í†µí•©í–ˆìŠµë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ì„¤ê³„ ì›ì¹™ (14ë²ˆ ê¸°ë°˜ + PRD ë°˜ì˜)
- **ë‹¨ìˆœì„± ìš°ì„ **: ModeManager, WebViewManager ì œê±°ë¡œ ë³µì¡ì„± ìµœì†Œí™”
- **ë¼ìš°íŒ… ê¸°ë°˜ í™•ì¥**: MessageBridge ë¼ìš°íŒ…ìœ¼ë¡œ ìƒˆ ì„œë¹„ìŠ¤ ë¬´ì¤‘ë‹¨ ì¶”ê°€  
- **í”„ë¡œí† íƒ€ì´í•‘ ì¤‘ì‹¬**: ì›¹ì•±ì´ ë©”ì¸, IDEëŠ” í•„ìš”ì‹œ ë„ìš°ëŠ” ë³´ì¡° ë„êµ¬
- **ëª¨ë“ˆí™” ì„¤ê³„**: ì„œë¹„ìŠ¤ ê°„ ë…ë¦½ì„± ë³´ì¥ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´
- **í…œí”Œë¦¿ ìš°ì„ **: PRD 32ë²ˆì— ë”°ë¼ 20ê°œ ì¹´í…Œê³ ë¦¬ í…œí”Œë¦¿ ì‹œìŠ¤í…œ ì¤‘ì‹¬

---

## ğŸ—ï¸ í†µí•© ì•„í‚¤í…ì²˜ ì„¤ê³„: ì¤‘ì•™ í—ˆë¸Œ(Central Hub) í™•ì¥ ëª¨ë¸

### 1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```mermaid
flowchart TD
    subgraph "ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤"
        A[ğŸ‘¤ ì‚¬ìš©ì] --> B[ğŸŒ Next.js ì›¹ì•±<br/>ëŒ€í™”ì‹ ë¹Œë”]
        B --> C[ğŸ’¬ AI ì±„íŒ… íŒ¨ë„]
        B --> D[ğŸ‘ï¸ ì‹¤ì‹œê°„ í”„ë¦¬ë·°]
        B --> E[ğŸ“‹ í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬<br/>20 ì¹´í…Œê³ ë¦¬]
        B --> F[ğŸ”„ 3ë‹¨ê³„ ë¹„êµ ë·°<br/>ë³´ìˆ˜ì /ê· í˜•ì /ëŒ€ë‹´í•œ]
    end
    
    subgraph "í™•ì¥ëœ MessageBridge í—ˆë¸Œ"
        G[ğŸ“¡ EnhancedMessageBridge<br/>ì¤‘ì•™ ë¼ìš°íŒ… í—ˆë¸Œ]
        H[ğŸ¤– AIWorkflowRouter<br/>NEW]
        I[ğŸ“‹ TemplateManager<br/>NEW - í•µì‹¬]
        J[ğŸ§  ConversationAI<br/>NEW]
        K[ğŸ”„ CustomizationEngine<br/>NEW]
    end
    
    subgraph "ê¸°ì¡´ ì„œë¹„ìŠ¤ (í˜¸í™˜)"
        L[ğŸ“ FileManager]
        M[ğŸ”¨ BuildManager]
        N[ğŸ¤– LLMService]
        O[âš™ï¸ CodeGenerationService]
    end
    
    C --> G
    D --> G
    E --> G
    F --> G
    
    G --> H
    H --> I
    H --> J
    H --> K
    
    G --> L
    G --> M
    G --> N
    G --> O
    
    style G fill:#ff9999,stroke:#333,stroke-width:3px
    style I fill:#99ff99,stroke:#333,stroke-width:2px
    style H fill:#99ccff,stroke:#333,stroke-width:2px
```

### 2. í•µì‹¬ ì›Œí¬í”Œë¡œìš°: í…œí”Œë¦¿ â†’ AI ì»¤ìŠ¤í„°ë§ˆì´ì§•

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ì‚¬ìš©ì
    participant UI as ğŸŒ ì›¹ì•± UI
    participant Bridge as ğŸ“¡ MessageBridge
    participant Template as ğŸ“‹ TemplateManager
    participant AI as ğŸ¤– ConversationAI
    participant Preview as ğŸ‘ï¸ Preview

    User->>UI: "e-commerce ì‚¬ì´íŠ¸ ë§Œë“¤ê³  ì‹¶ì–´ìš”"
    UI->>Bridge: {type: 'template:recommend', intent: 'ecommerce'}
    Bridge->>Template: findRecommendedTemplates('ecommerce')
    Template-->>Bridge: [template1, template2, template3]
    Bridge-->>UI: 3ê°œ í…œí”Œë¦¿ ì¶”ì²œ
    
    User->>UI: "ì²« ë²ˆì§¸ í…œí”Œë¦¿ìœ¼ë¡œ ì‹œì‘"
    UI->>Bridge: {type: 'template:apply', templateId: 'ecom-001'}
    Bridge->>Template: applyTemplate('ecom-001')
    Template-->>Bridge: í…œí”Œë¦¿ ì ìš© ì™„ë£Œ
    Bridge->>Preview: {type: 'preview:reload'}
    
    User->>UI: "í—¤ë”ë¥¼ ë” ëª¨ë˜í•˜ê²Œ ë°”ê¿”ì¤˜"
    UI->>Bridge: {type: 'ai:customize', request: 'í—¤ë”ë¥¼ ë” ëª¨ë˜í•˜ê²Œ', mode: 'balanced'}
    Bridge->>AI: generateOptions(request, currentTemplate)
    AI->>Template: get3LevelOptions('balanced')
    Template-->>AI: [conservative, balanced, bold]
    AI-->>Bridge: 3ë‹¨ê³„ ê°•ë„ë³„ ì˜µì…˜ ìƒì„±
    Bridge-->>UI: Before/After ë¹„êµ UI í‘œì‹œ
    
    User->>UI: "ê· í˜•ì  ì˜µì…˜ ì„ íƒ"
    UI->>Bridge: {type: 'customization:apply', option: 'balanced'}
    Bridge->>Preview: {type: 'preview:reload'}
```

---

## ğŸ”Œ í•µì‹¬ êµ¬í˜„ ì½”ë“œ (ì„¤ê³„)

### 1. `core/EnhancedMessageBridge.ts` (ì¤‘ì•™ í—ˆë¸Œ í™•ì¥)

```typescript
// [ì˜ë„] ê¸°ì¡´ MessageBridgeë¥¼ í™•ì¥í•˜ì—¬ AI ì›Œí¬í”Œë¡œìš° ë©”ì‹œì§€ ì²˜ë¦¬
// [ì±…ì„] ë©”ì‹œì§€ ë¼ìš°íŒ…, ì„œë¹„ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„± ìœ ì§€

import { MessageBridge } from './MessageBridge';
import { AIWorkflowRouter } from './AIWorkflowRouter';
import { TemplateManager } from '../services/TemplateManager';
import { ConversationAI } from '../services/ConversationAI';

export interface EnhancedWindWalkerMessage {
  type: 
    // ê¸°ì¡´ ë©”ì‹œì§€ íƒ€ì… (100% í˜¸í™˜)
    | 'chatRequest' | 'fileOperation' | 'buildRequest' | 'previewUpdate'
    // ìƒˆë¡œìš´ AI ì›Œí¬í”Œë¡œìš° íƒ€ì…
    | 'template:recommend' | 'template:apply' | 'template:compare'
    | 'ai:customize' | 'ai:compare' | 'customization:apply';
  
  // í™•ì¥ ë©”íƒ€ë°ì´í„°
  workflowType?: 'template' | 'customization' | 'comparison';
  sessionId?: string;
  templateId?: string;
  customizationLevel?: 'conservative' | 'balanced' | 'bold';
  
  // ê¸°ì¡´ í•„ë“œë“¤
  data?: any;
  source?: 'webview' | 'extension' | 'system';
}

export class EnhancedMessageBridge extends MessageBridge {
  private aiWorkflowRouter: AIWorkflowRouter;
  private templateManager: TemplateManager;
  private conversationAI: ConversationAI;
  private featureFlags: FeatureFlagManager;

  constructor(
    // ê¸°ì¡´ ì˜ì¡´ì„±ë“¤ (ë³€ê²½ ì—†ìŒ)
    fileManager: FileManager,
    buildManager: BuildManager,
    llmService: LLMService,
    codeGenerationService: CodeGenerationService,
    // ìƒˆë¡œìš´ ì˜ì¡´ì„±ë“¤
    templateManager: TemplateManager,
    conversationAI: ConversationAI
  ) {
    super(fileManager, buildManager, llmService, codeGenerationService);
    
    this.templateManager = templateManager;
    this.conversationAI = conversationAI;
    this.aiWorkflowRouter = new AIWorkflowRouter(templateManager, conversationAI);
    this.featureFlags = new FeatureFlagManager();
  }

  public async processMessage(
    message: EnhancedWindWalkerMessage, 
    source: MessageSource
  ): Promise<void> {
    // Feature Flag í™•ì¸: AI ì›Œí¬í”Œë¡œìš°ê°€ ë¹„í™œì„±í™”ëœ ê²½ìš° ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
    if (!this.featureFlags.isEnabled('ai_workflow') || this.isLegacyMessage(message)) {
      return await super.processMessage(message, source);
    }

    try {
      // AI ì›Œí¬í”Œë¡œìš° ë¼ìš°íŒ…
      const result = await this.aiWorkflowRouter.route(message, source);
      
      // ê²°ê³¼ ì „ë‹¬
      await this.sendResponse(result, source);
      
    } catch (error) {
      console.error('Enhanced message processing failed:', error);
      // ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œ í´ë°±
      return await super.processMessage(message, source);
    }
  }

  private isLegacyMessage(message: EnhancedWindWalkerMessage): boolean {
    return ['chatRequest', 'fileOperation', 'buildRequest', 'previewUpdate']
      .includes(message.type);
  }
}
```

### 2. `services/TemplateManager.ts` (í•µì‹¬ í…œí”Œë¦¿ ì‹œìŠ¤í…œ)

```typescript
// [ì˜ë„] PRD 32ì˜ í…œí”Œë¦¿ ìš”êµ¬ì‚¬í•­ êµ¬í˜„: 20ê°œ ì¹´í…Œê³ ë¦¬, Wix ìˆ˜ì¤€ ì „ë¬¸ í…œí”Œë¦¿ ê´€ë¦¬
// [ì±…ì„] í…œí”Œë¦¿ ì¶”ì²œ, ì ìš©, 3ë‹¨ê³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ ìƒì„±

export interface Template {
  id: string;
  name: string;
  category: TemplateCategory;
  subCategory?: string;
  description: string;
  thumbnailUrl: string;
  previewUrl: string;
  
  // í…œí”Œë¦¿ êµ¬ì¡° ì •ì˜
  structure: {
    sections: TemplateSection[];
    layout: 'single-page' | 'multi-page';
    responsive: boolean;
    animations: boolean;
  };
  
  // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì •
  defaultStyles: {
    colorScheme: ColorScheme;
    typography: Typography;
    spacing: SpacingConfig;
    components: ComponentStyleMap;
  };
  
  // ë©”íƒ€ë°ì´í„°
  popularity: number;
  industries: string[];
  targetAudience: string[];
  complexity: 'beginner' | 'intermediate' | 'advanced';
  isPremium: boolean;
  
  // ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•œ ì˜ì—­
  customizableAreas: CustomizableArea[];
}

export type TemplateCategory = 
  | 'business' | 'portfolio' | 'ecommerce' | 'blog' | 'restaurant'
  | 'healthcare' | 'education' | 'nonprofit' | 'realestate' | 'fitness'
  | 'wedding' | 'photography' | 'music' | 'consulting' | 'startup'
  | 'fashion' | 'travel' | 'technology' | 'creative' | 'events';

export interface CustomizationLevel {
  level: 'conservative' | 'balanced' | 'bold';
  changes: {
    colors?: ColorChange[];
    layout?: LayoutChange[];
    typography?: TypographyChange[];
    components?: ComponentChange[];
    animations?: AnimationChange[];
  };
  estimatedImpact: 'low' | 'medium' | 'high';
  description: string;
}

export class TemplateManager {
  private templates: Map<string, Template>;
  private categoryIndex: Map<TemplateCategory, string[]>;
  private fileManager: FileManager;

  constructor(fileManager: FileManager) {
    this.templates = new Map();
    this.categoryIndex = new Map();
    this.fileManager = fileManager;
    
    this.initializeTemplates();
  }

  // ê¸°ë³¸ í…œí”Œë¦¿ ì¶”ì²œ (ê°œì¸í™” ì—†ëŠ” ë²„ì „)
  public async recommendTemplates(
    userIntent: string,
    count: number = 3
  ): Promise<Template[]> {
    // 1. ì˜ë„ ë¶„ì„ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
    const categories = await this.analyzeIntentToCategories(userIntent);
    
    // 2. ì¹´í…Œê³ ë¦¬ë³„ í…œí”Œë¦¿ í›„ë³´ ìˆ˜ì§‘
    let candidates: Template[] = [];
    for (const category of categories) {
      const categoryTemplates = this.getTemplatesByCategory(category);
      candidates = candidates.concat(categoryTemplates);
    }
    
    // 3. ê¸°ë³¸ ìŠ¤ì½”ì–´ë§ ë° ë­í‚¹ (ì¸ê¸°ë„ ê¸°ì¤€)
    const scoredTemplates = candidates.map(template => ({
      template,
      score: this.calculateBasicScore(template, userIntent)
    }));
    
    // 4. ìƒìœ„ Nê°œ ë°˜í™˜
    return scoredTemplates
      .sort((a, b) => b.score - a.score)
      .slice(0, count)
      .map(item => item.template);
  }

  // í…œí”Œë¦¿ ì ìš©: íŒŒì¼ ì‹œìŠ¤í…œì— í…œí”Œë¦¿ êµ¬ì¡° ìƒì„±
  public async applyTemplate(templateId: string, projectPath: string): Promise<ApplyResult> {
    const template = this.templates.get(templateId);
    if (!template) {
      throw new Error(`Template not found: ${templateId}`);
    }

    const appliedFiles: string[] = [];

    try {
      // 1. ê¸°ë³¸ êµ¬ì¡° íŒŒì¼ ìƒì„±
      for (const section of template.structure.sections) {
        const files = await this.generateSectionFiles(section, template.defaultStyles);
        for (const file of files) {
          await this.fileManager.writeFile(
            path.join(projectPath, file.relativePath),
            file.content
          );
          appliedFiles.push(file.relativePath);
        }
      }

      // 2. ì„¤ì • íŒŒì¼ ìƒì„± (package.json, tailwind.config.js ë“±)
      const configFiles = await this.generateConfigFiles(template);
      for (const file of configFiles) {
        await this.fileManager.writeFile(
          path.join(projectPath, file.relativePath),
          file.content
        );
        appliedFiles.push(file.relativePath);
      }

      return {
        success: true,
        templateId,
        appliedFiles,
        customizableAreas: template.customizableAreas
      };

    } catch (error) {
      // ì‹¤íŒ¨ ì‹œ ìƒì„±ëœ íŒŒì¼ë“¤ ì •ë¦¬
      for (const file of appliedFiles) {
        try {
          await this.fileManager.deleteFile(path.join(projectPath, file));
        } catch (cleanupError) {
          console.warn('Cleanup failed for:', file, cleanupError);
        }
      }
      
      throw new Error(`Template application failed: ${error.message}`);
    }
  }

  // PRD í•µì‹¬ ìš”êµ¬ì‚¬í•­: 3ë‹¨ê³„ ê°•ë„ë³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ ìƒì„±
  public async generate3LevelCustomizations(
    templateId: string,
    userRequest: string,
    currentState: ProjectState
  ): Promise<CustomizationLevel[]> {
    const template = this.templates.get(templateId);
    if (!template) {
      throw new Error(`Template not found: ${templateId}`);
    }

    // AI ë¶„ì„ìœ¼ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ì—­ ì‹ë³„
    const targetAreas = await this.identifyCustomizationAreas(userRequest, template);
    
    const customizations: CustomizationLevel[] = [];

    // ë³´ìˆ˜ì  ì˜µì…˜: ìµœì†Œí•œì˜ ë³€ê²½
    customizations.push({
      level: 'conservative',
      changes: this.generateConservativeChanges(targetAreas, userRequest),
      estimatedImpact: 'low',
      description: 'ê¸°ì¡´ ë””ìì¸ íŒ¨í„´ì„ ìœ ì§€í•˜ë©° ì†Œí­ ê°œì„ '
    });

    // ê· í˜•ì  ì˜µì…˜: ì ë‹¹í•œ ë³€ê²½
    customizations.push({
      level: 'balanced',
      changes: this.generateBalancedChanges(targetAreas, userRequest),
      estimatedImpact: 'medium', 
      description: 'íŠ¸ë Œë””í•œ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ë©° ë ˆì´ì•„ì›ƒ ë¶€ë¶„ ê°œì„ '
    });

    // ëŒ€ë‹´í•œ ì˜µì…˜: í° ë³€ê²½
    customizations.push({
      level: 'bold',
      changes: this.generateBoldChanges(targetAreas, userRequest),
      estimatedImpact: 'high',
      description: 'ì‹¤í—˜ì  ë””ìì¸ê³¼ ìµœì‹  íŠ¸ë Œë“œë¥¼ ì ê·¹ ë°˜ì˜'
    });

    return customizations;
  }

  private async initializeTemplates(): Promise<void> {
    // PRD ìš”êµ¬ì‚¬í•­: 20ê°œ ì¹´í…Œê³ ë¦¬ë³„ í…œí”Œë¦¿ ë¡œë“œ
    const templateCategories: TemplateCategory[] = [
      'business', 'portfolio', 'ecommerce', 'blog', 'restaurant',
      'healthcare', 'education', 'nonprofit', 'realestate', 'fitness', 
      'wedding', 'photography', 'music', 'consulting', 'startup',
      'fashion', 'travel', 'technology', 'creative', 'events'
    ];

    for (const category of templateCategories) {
      await this.loadCategoryTemplates(category);
    }
  }

  private calculateBasicScore(template: Template, userIntent: string): number {
    let score = template.popularity * 0.5; // ê¸°ë³¸ ì¸ê¸°ë„

    // ì˜ë„ì™€ í…œí”Œë¦¿ ëª©ì ì˜ ì¼ì¹˜ë„
    const intentMatch = this.calculateIntentMatch(userIntent, template);
    score += intentMatch * 50;

    return Math.min(score, 100); // ìµœëŒ€ 100ì 
  }

  private async loadCategoryTemplates(category: TemplateCategory): Promise<void> {
    // ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìµœì†Œ 2ê°œì˜ ê³ í’ˆì§ˆ í…œí”Œë¦¿ ë¡œë“œ
    const templateIds: string[] = [];
    
    switch (category) {
      case 'business':
        templateIds.push('business-corporate-001', 'business-modern-001');
        break;
      case 'ecommerce':
        templateIds.push('ecommerce-fashion-001', 'ecommerce-general-001');
        break;
      case 'restaurant':
        templateIds.push('restaurant-cozy-001', 'restaurant-modern-001');
        break;
      // ... ë‚˜ë¨¸ì§€ ì¹´í…Œê³ ë¦¬ë“¤
    }
    
    for (const templateId of templateIds) {
      const template = await this.loadTemplateById(templateId);
      this.templates.set(templateId, template);
      
      // ì¹´í…Œê³ ë¦¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
      if (!this.categoryIndex.has(category)) {
        this.categoryIndex.set(category, []);
      }
      this.categoryIndex.get(category)!.push(templateId);
    }
  }
}
```

### 3. `services/ConversationAI.ts` (ëŒ€í™” ì²˜ë¦¬ ì—”ì§„)

```typescript
// [ì˜ë„] ì‚¬ìš©ìì˜ ìì—°ì–´ ìš”ì²­ì„ í…œí”Œë¦¿ ì‘ì—…ìœ¼ë¡œ ë³€í™˜
// [ì±…ì„] ì˜ë„ íŒŒì•…, 3ë‹¨ê³„ ì˜µì…˜ ìƒì„± ì§€ì›, ìì—°ì–´ ì´í•´

export interface ConversationContext {
  sessionId: string;
  templateId?: string;
  previousRequests: string[];
  currentProjectState: ProjectState;
}

export class ConversationAI {
  private llmService: LLMService;
  private codeGenerationService: CodeGenerationService;

  constructor(
    llmService: LLMService,
    codeGenerationService: CodeGenerationService
  ) {
    this.llmService = llmService;
    this.codeGenerationService = codeGenerationService;
  }

  // ì‚¬ìš©ì ì˜ë„ë¥¼ í…œí”Œë¦¿ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ì„
  public async analyzeTemplateIntent(userRequest: string): Promise<{
    categories: TemplateCategory[];
    confidence: number;
    keywords: string[];
  }> {
    const prompt = `
    ì‚¬ìš©ì ìš”ì²­: "${userRequest}"
    
    ì´ ìš”ì²­ì—ì„œ ì›í•˜ëŠ” ì›¹ì‚¬ì´íŠ¸ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.
    
    ê°€ëŠ¥í•œ ì¹´í…Œê³ ë¦¬: business, portfolio, ecommerce, blog, restaurant, healthcare, education, nonprofit, realestate, fitness, wedding, photography, music, consulting, startup, fashion, travel, technology, creative, events
    
    ì‘ë‹µ í˜•ì‹:
    - categories: [ìµœëŒ€ 3ê°œê¹Œì§€]
    - confidence: 0-1 ì‚¬ì´ ì‹ ë¢°ë„
    - keywords: ì¶”ì¶œëœ í•µì‹¬ í‚¤ì›Œë“œë“¤
    `;

    const response = await this.llmService.generateResponse(prompt);
    return this.parseIntentAnalysis(response);
  }

  // ì»¤ìŠ¤í„°ë§ˆì´ì§• ìš”ì²­ ë¶„ì„
  public async analyzeCustomizationIntent(
    userRequest: string,
    currentTemplate: Template
  ): Promise<{
    targetArea: string;
    intention: string;
    confidence: number;
    suggestedChanges: any;
  }> {
    const prompt = `
    í˜„ì¬ í…œí”Œë¦¿: ${currentTemplate.name} (${currentTemplate.category})
    ì‚¬ìš©ì ì»¤ìŠ¤í„°ë§ˆì´ì§• ìš”ì²­: "${userRequest}"
    
    ì´ ìš”ì²­ì„ ë¶„ì„í•˜ì—¬ ë‹¤ìŒì„ ì œê³µí•´ì£¼ì„¸ìš”:
    1. ë³€ê²½í•˜ë ¤ëŠ” ì˜ì—­ (header, hero, menu, footer, content ë“±)
    2. ë³€ê²½ ì˜ë„ (modernize, colorize, simplify, emphasize ë“±)
    3. ì‹ ë¢°ë„ (0-1)
    4. êµ¬ì²´ì ì¸ ë³€ê²½ ì œì•ˆ
    
    í˜„ì¬ í…œí”Œë¦¿ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥ ì˜ì—­: ${currentTemplate.customizableAreas.map(area => area.name).join(', ')}
    `;

    const response = await this.llmService.generateResponse(prompt);
    return this.parseCustomizationAnalysis(response);
  }

  // 3ë‹¨ê³„ ê°•ë„ë³„ ë³€ê²½ì‚¬í•­ ìƒì„± ì§€ì›
  public async generateVariationOptions(
    baseChange: any,
    level: 'conservative' | 'balanced' | 'bold'
  ): Promise<any> {
    const intensityMap = {
      conservative: 'ìµœì†Œí•œì˜ ë³€ê²½ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ',
      balanced: 'ì ë‹¹í•œ ìˆ˜ì¤€ì˜ íŠ¸ë Œë””í•œ ë³€ê²½',
      bold: 'ì‹¤í—˜ì ì´ê³  ëŒ€ë‹´í•œ ë³€ê²½'
    };

    const prompt = `
    ê¸°ë³¸ ë³€ê²½ì‚¬í•­: ${JSON.stringify(baseChange)}
    ë³€ê²½ ê°•ë„: ${level} (${intensityMap[level]})
    
    ì´ ê°•ë„ì— ë§ëŠ” êµ¬ì²´ì ì¸ ë³€ê²½ì‚¬í•­ì„ ìƒì„±í•´ì£¼ì„¸ìš”:
    - CSS ë³€ê²½ì‚¬í•­
    - HTML êµ¬ì¡° ë³€ê²½ (í•„ìš”ì‹œ)
    - ì¶”ê°€/ì œê±°í•  ìš”ì†Œë“¤
    `;

    const response = await this.llmService.generateResponse(prompt);
    return this.parseVariationOptions(response);
  }

  private parseIntentAnalysis(response: string): any {
    // LLM ì‘ë‹µì„ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ íŒŒì‹±
    try {
      return JSON.parse(response);
    } catch {
      // íŒŒì‹± ì‹¤íŒ¨ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
      return {
        categories: ['business'],
        confidence: 0.5,
        keywords: []
      };
    }
  }

  private parseCustomizationAnalysis(response: string): any {
    try {
      return JSON.parse(response);
    } catch {
      return {
        targetArea: 'unknown',
        intention: 'general',
        confidence: 0.5,
        suggestedChanges: {}
      };
    }
  }
}
```

---

## ğŸ¯ í•µì‹¬ ì›Œí¬í”Œë¡œìš° ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: í…œí”Œë¦¿ ì¶”ì²œ â†’ ì„ íƒ â†’ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```
ì‚¬ìš©ì: "ìŒì‹ì  ì‚¬ì´íŠ¸ë¥¼ ë§Œë“¤ê³  ì‹¶ì–´ìš”"

1. ConversationAI.analyzeTemplateIntent('ìŒì‹ì  ì‚¬ì´íŠ¸')
   â†’ ë¶„ì„ ê²°ê³¼: categories: ['restaurant'], confidence: 0.9
   
2. TemplateManager.recommendTemplates('ìŒì‹ì  ì‚¬ì´íŠ¸')
   â†’ ì¶”ì²œ: [restaurant-cozy-001, restaurant-modern-001, restaurant-elegant-001]

3. ì‚¬ìš©ì: "ì²« ë²ˆì§¸ í…œí”Œë¦¿ìœ¼ë¡œ ì‹œì‘í• ê²Œìš”"
   â†’ TemplateManager.applyTemplate('restaurant-cozy-001')
   â†’ ê²°ê³¼: ê¸°ë³¸ ìŒì‹ì  ì‚¬ì´íŠ¸ ìƒì„± (HTML/CSS/JS íŒŒì¼ë“¤)

4. ì‚¬ìš©ì: "ë©”ë‰´ ì„¹ì…˜ì„ ì¢€ ë” ëˆˆì— ë„ê²Œ í•´ì£¼ì„¸ìš”"
   â†’ ConversationAI.analyzeCustomizationIntent() 
   â†’ ë¶„ì„: targetArea: 'menu', intention: 'emphasize'
   â†’ TemplateManager.generate3LevelCustomizations()
   â†’ 3ë‹¨ê³„ ì˜µì…˜ ì œì‹œ:
     - ë³´ìˆ˜ì : ë©”ë‰´ í…ìŠ¤íŠ¸ í¬ê¸°ë§Œ ì¦ê°€
     - ê· í˜•ì : ë©”ë‰´ ë°°ê²½ ìƒ‰ìƒ + ì•„ì´ì½˜ ì¶”ê°€  
     - ëŒ€ë‹´í•œ: ì „ì²´ ë©”ë‰´ ì„¹ì…˜ ë ˆì´ì•„ì›ƒ ì¬êµ¬ì„±

5. ì‚¬ìš©ì: "ê· í˜•ì  ì˜µì…˜ì´ ì¢‹ë„¤ìš”"
   â†’ ë³€ê²½ì‚¬í•­ ì ìš© â†’ Preview ì—…ë°ì´íŠ¸
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹¤ì‹œê°„ ë¹„êµ ë° ì„ íƒ

```
ì‚¬ìš©ì: "í—¤ë”ë¥¼ ë” ëª¨ë˜í•˜ê²Œ ë°”ê¿”ì¤˜"

1. 3ë‹¨ê³„ ì˜µì…˜ ìƒì„± ë° ë¯¸ë¦¬ë³´ê¸°
   â†’ í˜„ì¬ ìƒíƒœ + ë³´ìˆ˜ì  + ê· í˜•ì  + ëŒ€ë‹´í•œ ì˜µì…˜ 4ê°œ ë™ì‹œ í‘œì‹œ
   
2. ì‚¬ìš©ìê°€ ì‹œê°ì ìœ¼ë¡œ ë¹„êµí•˜ì—¬ ì„ íƒ
   â†’ "ëŒ€ë‹´í•œ ì˜µì…˜ì´ ë§ˆìŒì— ë“¤ì–´ìš”"
   
3. ì„ íƒëœ ì˜µì…˜ ì ìš©
   â†’ íŒŒì¼ ë³€ê²½ â†’ ë¹Œë“œ â†’ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
```

---

## ğŸ“Š ë°ì´í„° ëª¨ë¸ ì„¤ê³„

### í…œí”Œë¦¿ êµ¬ì¡°

```typescript
interface TemplateSection {
  id: string;
  name: string; // 'header', 'hero', 'features', 'footer' etc.
  htmlTemplate: string;
  cssStyles: string;
  jsLogic?: string;
  customizableProperties: CustomizableProperty[];
}

interface CustomizableProperty {
  name: string;
  type: 'color' | 'typography' | 'spacing' | 'layout';
  currentValue: any;
  possibleValues?: any[];
  constraints?: PropertyConstraints;
}

interface ProjectState {
  templateId: string;
  appliedCustomizations: AppliedCustomization[];
  currentFiles: ProjectFile[];
  lastModified: Date;
}
```

### ì»¤ìŠ¤í„°ë§ˆì´ì§• ë³€ê²½ì‚¬í•­

```typescript
interface ColorChange {
  selector: string;
  property: 'background-color' | 'color' | 'border-color';
  from: string;
  to: string;
}

interface LayoutChange {
  selector: string;
  property: 'display' | 'flex-direction' | 'grid-template';
  from: string;
  to: string;
}

interface ComponentChange {
  action: 'add' | 'remove' | 'modify';
  selector: string;
  element?: string; // for 'add'
  content?: string; // for 'add' or 'modify'
}
```

ì´ ì„¤ê³„ëŠ” **14ë²ˆ ê¸°ë³¸ ë¬¸ì„œ**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë˜, **PRD 32ë²ˆì˜ í…œí”Œë¦¿ ìš”êµ¬ì‚¬í•­**ì„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ Git+IndexedDB ì—†ì´ë„ í•µì‹¬ AI ì›Œí¬í”Œë¡œìš°ê°€ ë™ì‘í•˜ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.