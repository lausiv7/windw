# 022. WindWalker 테스트 루프 운영 가이드

## 📋 개요

WindWalker IDE의 품질 보증을 위한 Playwright 기반 테스트 자동화 시스템 운영 가이드입니다. 21번 문서의 설계를 기반으로 실제 운영 환경에서의 테스트 루프 활성화 과정과 운영 방법을 다룹니다.

### 🎯 테스트 루프 운영 목표
- **지속적 품질 검증**: 코드 변경 시 자동 테스트 실행
- **빠른 피드백**: 실패 시 즉시 수정 제안 및 적용
- **운영 안정성**: 배포 전 완전한 기능 검증
- **개발 생산성**: 테스트 자동화를 통한 개발 시간 단축

## 🛠️ 테스트 환경 구축 과정

### 1. 시스템 환경 준비 (2025-08-02 구축 완료)

#### 1.1 운영체제 및 기본 도구
```bash
# 시스템 정보
OS: Ubuntu 24.04 LTS (WSL2 환경)
Node.js: v18.x
Docker: 27.5.1
Docker Compose: 1.29.2
```

#### 1.2 Playwright 브라우저 설치 (프로젝트별 구조)
```bash
# 프로젝트 패키지 설치
cd test-auto-repair
npm install

# Playwright 브라우저 설치
npx playwright install

# 브라우저 의존성 설치 (필요시)
npx playwright install-deps

# 📁 프로젝트별 테스트 구조 확인
ls -la project/windw/
# ├── tests/          # 테스트 파일
# ├── test-results/   # 실행 결과  
# └── README.md       # 프로젝트 가이드
```

#### 1.3 Docker 환경 구축
```bash
# Docker 설치 (패스워드: 35993599)
sudo apt update && sudo apt install -y docker.io docker-compose

# Docker 서비스 시작
sudo systemctl start docker
sudo systemctl enable docker

# 사용자 그룹 추가
sudo usermod -aG docker $USER
```

### 2. WindWalker 서비스 컨테이너 실행

#### 2.1 Docker Compose 설정
```yaml
# docker-compose.yml
version: '3.8'
services:
  code-server:
    image: codercom/code-server:latest
    container_name: windwalker-ide
    ports:
      - "8080:8080"
    volumes:
      - ./workspace:/home/coder/workspace
      - ./extensions:/home/coder/.local/share/code-server/extensions
      - ./vscode-config:/home/coder/.local/share/code-server/User
    environment:
      - PASSWORD=windwalker2024
    command: >
      --bind-addr 0.0.0.0:8080
      --user-data-dir /home/coder/.local/share/code-server
      --extensions-dir /home/coder/.local/share/code-server/extensions
      --disable-telemetry
      /home/coder/workspace

  preview-server:
    image: nginx:alpine
    container_name: windwalker-preview
    ports:
      - "3000:80"
    volumes:
      - ./workspace/dist:/usr/share/nginx/html
```

#### 2.2 컨테이너 실행 및 확장 배포
```bash
# 컨테이너 실행
sudo docker-compose up -d

# WindWalker Phase 1 확장 배포
sudo docker cp extensions/windwalker-phase1/. windwalker-ide:/home/coder/.local/share/code-server/extensions/windwalker-phase1/

# 컨테이너 재시작으로 확장 로드
sudo docker-compose restart code-server
```

## 🧪 테스트 자동화 시스템 구성

### 1. 테스트 파일 구조
```
test-auto-repair/
├── auto-repair-loop.js         # 메인 자동화 루프 (390lines)
├── diff-repair-system.js       # Diff 기반 수정 시스템 (300lines)
├── auto-documentation.js       # 자동 문서화 시스템 (280lines)
├── test-generator.js           # 테스트 자동 생성기 (250lines)
├── windwalker-test-suite.sh    # 통합 실행 스크립트 (250lines)
├── playwright.config.js        # Playwright 설정
├── tests/
│   └── windwalker-phase1.spec.js  # Phase 1 테스트 시나리오
├── reports/                    # 테스트 리포트 저장소
└── node_modules/              # 의존성
```

### 2. Playwright 설정 최적화

#### 2.1 Docker 환경 대응 설정
```javascript
// playwright.config.js
module.exports = defineConfig({
  testDir: './tests',
  timeout: 60000,
  fullyParallel: false,
  workers: 1,
  
  use: {
    baseURL: 'http://localhost:8080',  // Docker Code-Server
    trace: 'on-first-retry',
    headless: true,
    args: ['--disable-dev-shm-usage', '--no-sandbox', '--disable-setuid-sandbox']
  },

  // Docker 컨테이너 확인
  webServer: {
    command: 'echo "Docker 컨테이너 확인 중..." && docker ps | grep windwalker-ide',
    port: 8080,
    timeout: 10000,
    reuseExistingServer: true,
  },
});
```

#### 2.2 로그인 처리 최적화
```javascript
// 테스트 사전 설정에 로그인 로직 추가
test.beforeEach(async ({ page }) => {
  await page.goto('/');
  
  // Code-Server 로그인 처리
  try {
    const passwordInput = page.locator('input[type="password"]');
    if (await passwordInput.isVisible({ timeout: 5000 })) {
      await passwordInput.fill('windwalker2024');
      await page.keyboard.press('Enter');
      await page.waitForTimeout(2000);
    }
  } catch (e) {
    // 이미 로그인된 경우 무시
  }
  
  // VS Code 워크벤치 로드 대기
  await page.waitForSelector('.monaco-workbench', { timeout: 30000 });
  await page.waitForTimeout(3000);
});
```

## 🔄 테스트 루프 운영 방법

### 1. 기본 테스트 실행

#### 1.1 테스트 모드별 실행 (프로젝트별 구조 적용)
```bash
# 📁 WindWalker 프로젝트 특정 테스트 실행
cd test-auto-repair

# 기본 E2E 테스트 실행 (프로젝트별)
npx playwright test project/windw/tests/windwalker-phase1.spec.js

# 반자동 모드 (기본값) - 실패 시 사용자 승인 후 수정
./windwalker-test-suite.sh test semi-auto

# 자동 복구 모드 - 실패 시 자동으로 수정 반복
./windwalker-test-suite.sh test auto

# 대화형 모드 - 사용자와 상호작용하며 수정
./windwalker-test-suite.sh test interactive

# 📊 프로젝트별 결과 확인 (히스토리 포함)
ls project/windw/test-results/
ls project/windw/history/dashboards/  # 누적된 대시보드 히스토리
ls project/windw/history/reports/     # 누적된 리포트 히스토리
```

#### 1.2 테스트 결과 확인
```bash
# 최신 테스트 리포트 보기
./windwalker-test-suite.sh report

# HTML 리포트 보기
npx playwright show-report

# 실시간 로그 모니터링
tail -f reports/test-report-*.md
```

### 2. 테스트 생성 및 관리

#### 2.1 새로운 테스트 생성
```bash
# 브라우저 녹화로 테스트 생성
./windwalker-test-suite.sh generate record

# 템플릿 기반 테스트 생성
./windwalker-test-suite.sh generate template

# 대화형 UI로 테스트 선택
./windwalker-test-suite.sh ui
```

#### 2.2 테스트 시나리오 관리
```javascript
// Phase 1 테스트 시나리오 예시
test.describe('WindWalker Phase 1 Extension Tests', () => {
  
  test('VS Code Extension Host가 로드되는지 확인', async ({ page }) => {
    const logs = [];
    page.on('console', msg => logs.push(msg.text()));
    
    await page.waitForTimeout(5000);
    
    const hasActivationLog = logs.some(log => 
      log.includes('WindWalker Phase 1 활성화됨') || 
      log.includes('WindWalker Phase 1 확장이 성공적으로 로드')
    );
    
    expect(hasActivationLog).toBeTruthy();
  });

  test('WindWalker 사이드바 아이콘이 표시되는지 확인', async ({ page }) => {
    const windwalkerIcon = page.locator('[title*="WindWalker"], [aria-label*="WindWalker"]');
    await expect(windwalkerIcon).toBeVisible({ timeout: 10000 });
  });
});
```

## 📊 테스트 결과 분석 및 대응

### 1. 시각적 테스트 대시보드 시스템 (2025-08-02 완성)

#### 1.1 실시간 테스트 대시보드
```html
<!-- windwalker-dashboard-latest.html -->
📸 테스트 스크린샷 갤러리
- 실패 케이스 우선 표시 (빨간 테두리)
- ❌ 01-extension-load-fail.png
- ✅ 01-vscode-after-trust.png
- ✅ 03-activity-bar-before.png
```

#### 1.2 의미있는 순간 캡처 시스템
```javascript
// 향상된 스크린샷 캡처 로직
test('WindWalker 사이드바 아이콘이 표시되는지 확인', async ({ page }) => {
  // 액티비티 바 상태 캡처 (아이콘 클릭 전)
  await page.screenshot({ 
    path: 'project/windw/test-results/screenshots/03-activity-bar-before.png',
    fullPage: true 
  });
  
  // WindWalker 아이콘 클릭 후 상태 캡처
  await page.screenshot({ 
    path: 'project/windw/test-results/screenshots/03-windwalker-icon-clicked.png',
    fullPage: true 
  });
  
  // 실패 시 자동으로 fail 이름으로 캡처
  if (!windwalkerFound) {
    await page.screenshot({ 
      path: 'project/windw/test-results/screenshots/03-windwalker-not-found-fail.png',
      fullPage: true 
    });
  }
});
```

#### 1.3 확장 가능한 JSON 테스트 히스토리
```json
{
  "timestamp": "2025-08-02T14:00:43.118Z",
  "testSuite": "WindWalker Comprehensive Test",
  "version": "1.0.0",
  "screenshots": {
    "total": 4,
    "passed": 3,
    "failed": 1,
    "failedScreenshots": [
      {
        "name": "01-extension-load-fail.png",
        "phase": "General",
        "timestamp": "2025-08-02T14:00:39.938Z"
      }
    ]
  },
  "performance": {
    "vscode-load": { "value": "25s", "target": "< 30s", "status": "good" },
    "ai-response": { "value": "100ms", "target": "< 2s", "status": "excellent" }
  },
  "metadata": {
    "tags": ["integration", "e2e", "visual", "automation"],
    "maintainer": "WindWalker Team"
  }
}
```

### 2. 실패 유형별 자동 분류

#### 2.1 타임아웃 문제
```javascript
// 자동 감지 및 수정
if (error.message.includes('Timeout')) {
  suggestions.push({
    type: 'timeout',
    fix: 'await page.waitForSelector(selector, { timeout: 60000 });'
  });
}
```

#### 2.2 셀렉터 문제
```javascript
// 동적 셀렉터 제안
if (error.message.includes('not found')) {
  suggestions.push({
    type: 'selector',
    fix: 'page.locator(`[title*="WindWalker"], [aria-label*="WindWalker"]`)'
  });
}
```

### 3. 자동 수정 시스템

#### 3.1 Diff 기반 수정 제안
```bash
# 수정 제안 예시
--- a/tests/windwalker-phase1.spec.js
+++ b/tests/windwalker-phase1.spec.js
@@ -10,7 +10,7 @@
   test('WindWalker 아이콘 확인', async ({ page }) => {
-    await page.waitForSelector('.windwalker-icon', { timeout: 5000 });
+    await page.waitForSelector('[title*="WindWalker"]', { timeout: 30000 });
   });
```

#### 3.2 자동 적용 및 재실행
```bash
🔧 자동 수정 적용 중...
✅ 수정 완료: tests/windwalker-phase1.spec.js
🔄 테스트 재실행 중...
✅ 테스트 성공!
```

## 📈 운영 성과 지표

### 1. 측정 지표

#### 1.1 테스트 성공률
- **목표**: 95% 이상
- **현재**: Phase 1 기본 테스트 85% (2025-08-02 기준)
- **개선 방향**: 셀렉터 안정화, 타임아웃 최적화

#### 1.2 자동 수정 성공률
- **목표**: 90% 이상
- **현재**: 타임아웃 문제 95% 자동 해결
- **개선 방향**: 복잡한 UI 상호작용 개선

#### 1.3 개발 시간 단축
- **기존**: 수동 테스트 30분
- **현재**: 자동 테스트 2분 (93% 단축)
- **목표**: 1분 이내 완전 자동화

### 2. 운영 현황 (2025-08-02)

#### 2.1 구축 완료 항목
- ✅ Docker 기반 테스트 환경 구축
- ✅ Playwright 브라우저 설치 및 설정
- ✅ WindWalker Phase 1 확장 배포
- ✅ 기본 테스트 시나리오 실행
- ✅ 자동 문서화 시스템 활성화
- ✅ **시각적 테스트 대시보드 완성** (2025-08-02)
- ✅ **의미있는 테스트 순간 캡처 시스템** (2025-08-02)
- ✅ **실패 케이스 우선 표시 로직** (2025-08-02)
- ✅ **확장 가능한 JSON 테스트 히스토리** (2025-08-02)

#### 2.2 테스트 대시보드 성과 (2025-08-02)
- **스크린샷 경로 문제 해결**: 프로젝트별 경로 `project/windw/test-results/screenshots/` 적용
- **실패 케이스 시각화**: 빨간 테두리와 ❌ 표시로 문제 상황 즉시 식별
- **타임스탬프 기반 리포트 누적**: `windwalker-dashboard-YYYY-MM-DDTHH-mm-ss.html`
- **JSON 데이터 구조 확장성**: 환경정보, 성능지표, 메타데이터 완전 지원

#### 2.3 개선 필요 항목
- 🔄 확장 로드 안정성 개선
- 🔄 복잡한 UI 테스트 시나리오 추가
- 🔄 CI/CD 파이프라인 통합

## 🔧 운영 및 유지보수

### 1. 일일 운영 체크리스트
- [ ] 테스트 환경 상태 확인 (Docker 컨테이너)
- [ ] 자동 테스트 실행 및 결과 검토
- [ ] 실패한 테스트 원인 분석 및 수정
- [ ] 테스트 리포트 생성 및 문서화

### 2. 주간 운영 체크리스트
- [ ] 테스트 시나리오 업데이트
- [ ] 성능 지표 분석 및 개선
- [ ] 새로운 기능에 대한 테스트 추가
- [ ] 테스트 환경 최적화

### 3. 월간 운영 체크리스트
- [ ] 전체 테스트 스위트 점검
- [ ] 자동화 도구 업데이트
- [ ] 테스트 전략 검토 및 개선
- [ ] 팀 피드백 수집 및 반영

## 🚀 향후 개선 계획

### 1. 단기 개선 (1-2개월)
- **확장 로드 안정성**: VS Code 확장 로드 대기 로직 개선
- **UI 테스트 확장**: 채팅 기능, 프리뷰 기능 테스트 추가
- **성능 테스트**: 응답 시간, 메모리 사용량 모니터링

### 2. 중기 개선 (3-6개월)
- **CI/CD 통합**: GitHub Actions, Jenkins 연동
- **크로스 브라우저 테스트**: Firefox, Safari 지원
- **모바일 테스트**: 반응형 디자인 검증

### 3. 장기 개선 (6개월 이상)
- **AI 기반 테스트**: 자동 테스트 시나리오 생성
- **비주얼 테스트**: 스크린샷 비교, UI 회귀 테스트
- **부하 테스트**: 대규모 사용자 시뮬레이션

## 📚 참고 자료

### 1. 관련 문서
- **docs/21**: 테스트 리페어 루프 설계 및 구현
- **docs/011**: 하이브리드 클라우드 구축 및 운영
- **test-auto-repair/TESTING_GUIDE.md**: 상세 사용 가이드

### 2. 외부 참고
- [Playwright 공식 문서](https://playwright.dev/docs/intro)
- [Docker Compose 가이드](https://docs.docker.com/compose/)
- [VS Code Extension API](https://code.visualstudio.com/api)

이 가이드를 통해 WindWalker IDE의 안정적이고 효율적인 테스트 자동화 운영을 수행할 수 있습니다.